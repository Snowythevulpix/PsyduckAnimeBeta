<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Psyduckanime - The best place to watch Pokemon without ads</title>
  <meta property="og:title" content="Psyduckanime - The best place to watch Pokemon without ads"/>
  <meta property="og:image" content="/assets/Psyduck.png"/>
  <!-- Favicon -->
  <link rel="icon" href="/assets/Psyduck.png"/>
  <link rel="stylesheet" href="/assets/style.css">
</head>
<body>
  <!-- Home button image -->
  <a href="/">
    <img class="home-button" src="/assets/logo.png" alt="Home">
  </a>

  <div class="container">
    <img class="artwork" src="" alt="Artwork">
    <div class="info">
      <h2 class="title">Title</h2>
      <p class="title-info"></p>
      <h2 class="description-title">Description</h2>
      <p class="description"></p>
    </div>
  </div>

  <div id="sub-dub-buttons" style="display: none;">
    <button onclick="selectSub()">Sub</button>
    <button onclick="selectDub()">Dub</button>
  </div>

  <div id="episode-links" style="display: none;">
    <!-- This is where episode links will be added -->
  </div>
  <script>
    let scrolled = false; // Variable to track if the scroll condition was met
    let totalEpisodes = 0; // Variable to store the total episodes
    let subtype = null; // Variable to store the user's selection
  
    function updateSource(id, subtype) {
      fetch('./assets/bestsource.json')
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json();
        })
        .then(data => {
          let source = null;
  
          // Find the source for the given ID
          data.forEach(item => {
            if (item[id]) {
              source = item[id][subtype];
            }
          });
  
          if (source) {
            const episodeLinksContainer = document.getElementById('episode-links');
            const links = episodeLinksContainer.querySelectorAll('.link');
            links.forEach((link, index) => {
              const episode = index + 1;
              const playUrl = `play?anilistid=${id}&episode=${episode}&source=${source}&subtype=${subtype}`;
              link.href = playUrl;
            });
          } else {
            console.error('Source not found in JSON file');
          }
        })
        .catch(error => {
          console.error('Error fetching JSON file:', error);
        });
    }
  
    function selectSub() {
      subtype = 'sub';
      const currentUrl = window.location.href;
      const idIndex = currentUrl.lastIndexOf('?');
      const id = idIndex !== -1 ? currentUrl.slice(idIndex + 1) : null;
      if (id) {
        updateSource(id, subtype);
        showEpisodeButtons();
      } else {
        console.error('No ID found in the URL');
      }
    }
  
    function selectDub() {
      subtype = 'dub';
      const currentUrl = window.location.href;
      const idIndex = currentUrl.lastIndexOf('?');
      const id = idIndex !== -1 ? currentUrl.slice(idIndex + 1) : null;
      if (id) {
        updateSource(id, subtype);
        showEpisodeButtons();
      } else {
        console.error('No ID found in the URL');
      }
    }
  
    function showEpisodeButtons() {
      document.getElementById('sub-dub-buttons').style.display = 'none';
      document.getElementById('episode-links').style.display = 'block';
      createEpisodeButtons(totalEpisodes, subtype);
    }
  
    function createEpisodeButtons(totalEpisodes, subtype) {
      const episodeLinksContainer = document.getElementById('episode-links');
      episodeLinksContainer.innerHTML = ''; // Clear the container
  
      const currentUrl = window.location.href;
      const idIndex = currentUrl.lastIndexOf('?');
      const id = idIndex !== -1 ? currentUrl.slice(idIndex + 1) : null;
  
      for (let episode = 1; episode <= totalEpisodes; episode++) {
        let link = document.createElement('a');
        link.className = 'link';
  
        const playUrl = `play?anilistid=${id}&episode=${episode}&source=gogoanime&subtype=${subtype}`;
  
        link.href = playUrl;
        link.target = '_self';
        link.textContent = episode.toString();
  
        episodeLinksContainer.appendChild(link);
  
        if (episode % 5 === 0) {
          episodeLinksContainer.appendChild(document.createElement('br'));
        }
      }
  
      episodeLinksContainer.style.display = 'block';
    }
  
    window.addEventListener('DOMContentLoaded', () => {
  const currentUrl = window.location.href;
  const idIndex = currentUrl.lastIndexOf('?');
  const id = idIndex !== -1 ? currentUrl.slice(idIndex + 1) : null;

  if (id) {
    fetch(`https://consumet-nine-mu.vercel.app/meta/mal/info/${id}`)
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.json();
      })
      .then(data => {
        const total = data.totalEpisodes || 0;

        const artwork = data.image || ''; // Accessing the image URL directly
        const englishName = data.english || '';
        const description = data.description || '';
        const englishTitle = data.title.english || 'Not available';
        const romajiTitle = data.title.romaji || 'Not available';

        const artworkImg = document.querySelector('.artwork');
        artworkImg.src = artwork; // Assign the artwork URL directly to the src attribute

        const descriptionElement = document.querySelector('.description');
        descriptionElement.textContent = description;

        const titleElement = document.querySelector('.title-info');
        titleElement.textContent = `English: ${englishTitle}\nRomaji: ${romajiTitle}`;

        totalEpisodes = total;

        document.getElementById('sub-dub-buttons').style.display = 'block';
      })
      .catch(error => {
        console.error('Error fetching data:', error);
      });
  } else {
    console.error('No ID found in the URL');
  }
});
  </script>
  
</body>
</html>
